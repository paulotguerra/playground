<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Comprar ou Assinar?</title>
    
    <!-- Manifesto din√¢mico para PWA -->
    <link id="pwa-manifest" rel="manifest" href="">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para compilar JSX no browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <!-- PWA Setup Script -->
    <script>
        // 1. Configurar o Manifesto Din√¢mico
        const manifest = {
            "name": "Calculadora Fiat: Comprar vs Assinar",
            "short_name": "Calc. Carro",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#f8fafc",
            "theme_color": "#2563eb",
            "icons": [
                {
                    "src": "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3Eüöó%3C/text%3E%3C/svg%3E",
                    "sizes": "192x192",
                    "type": "image/svg+xml"
                }
            ]
        };
        const manifestString = JSON.stringify(manifest);
        const manifestUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(manifestString);
        document.getElementById('pwa-manifest').setAttribute('href', manifestUri);

        // 2. Configurar o Service Worker Din√¢mico
        const swCode = `
            const CACHE_NAME = 'calc-carro-v1';
            self.addEventListener('install', event => {
                self.skipWaiting();
            });
            self.addEventListener('fetch', event => {
                event.respondWith(
                    fetch(event.request).catch(() => caches.match(event.request))
                );
            });
        `;
        const swBlob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(swBlob);

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register(swUrl).catch(err => {
                    console.log('Registo do Service Worker falhou (esperado em alguns iframes): ', err);
                });
            });
        }
    </script>

    <!-- Aplica√ß√£o React -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- √çCONES SVG (Substituindo depend√™ncias externas para funcionar offline) ---
        const Icon = ({ children, className = "w-5 h-5" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );
        const Car = ({className}) => <Icon className={className}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></Icon>;
        const Calculator = ({className}) => <Icon className={className}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></Icon>;
        const Info = ({className}) => <Icon className={className}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;
        const TrendingDown = ({className}) => <Icon className={className}><polyline points="22 17 13.5 8.5 8.5 13.5 2 7"/><polyline points="16 17 22 17 22 11"/></Icon>;
        const CheckCircle2 = ({className}) => <Icon className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></Icon>;
        const Banknote = ({className}) => <Icon className={className}><rect width="20" height="12" x="2" y="6" rx="2"/><circle cx="12" cy="12" r="2"/><path d="M6 12h.01M18 12h.01"/></Icon>;
        const FileText = ({className}) => <Icon className={className}><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"/><path d="M14 2v4a2 2 0 0 0 2 2h4"/><path d="M10 9H8"/><path d="M16 13H8"/><path d="M16 17H8"/></Icon>;
        const Shield = ({className}) => <Icon className={className}><path d="M20 13c0 5-3.5 8.67-8 10-4.5-1.33-8-5-8-10V5l8-3 8 3z"/></Icon>;
        const Wrench = ({className}) => <Icon className={className}><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></Icon>;

        // --- COMPONENTES AUXILIARES ---
        const Card = ({ children, className = "" }) => (
            <div className={`bg-white rounded-xl shadow-md border border-gray-100 overflow-hidden ${className}`}>
                {children}
            </div>
        );

        // Formata√ß√£o BRL para o contexto Brasileiro solicitado
        const formatCurrency = (value) => {
            if (value === undefined || value === null) return 'R$ 0,00';
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);
        };

        const ESTADOS_IPVA = [
            { sigla: 'AC', taxa: 2.0 }, { sigla: 'AL', taxa: 3.0 }, { sigla: 'AP', taxa: 3.0 },
            { sigla: 'AM', taxa: 3.0 }, { sigla: 'BA', taxa: 2.5 }, { sigla: 'CE', taxa: 3.0 },
            { sigla: 'DF', taxa: 3.5 }, { sigla: 'ES', taxa: 2.0 }, { sigla: 'GO', taxa: 3.75 },
            { sigla: 'MA', taxa: 2.5 }, { sigla: 'MT', taxa: 3.0 }, { sigla: 'MS', taxa: 3.0 },
            { sigla: 'MG', taxa: 4.0 }, { sigla: 'PA', taxa: 2.5 }, { sigla: 'PB', taxa: 2.5 },
            { sigla: 'PR', taxa: 3.5 }, { sigla: 'PE', taxa: 3.0 }, { sigla: 'PI', taxa: 3.0 },
            { sigla: 'RJ', taxa: 4.0 }, { sigla: 'RN', taxa: 3.0 }, { sigla: 'RS', taxa: 3.0 },
            { sigla: 'RO', taxa: 3.0 }, { sigla: 'RR', taxa: 3.0 }, { sigla: 'SC', taxa: 2.0 },
            { sigla: 'SP', taxa: 4.0 }, { sigla: 'SE', taxa: 2.5 }, { sigla: 'TO', taxa: 2.0 },
        ];

        function App() {
            // --- ESTADO (STATE) ---
            const [inputs, setInputs] = useState({
                modelo: 'Fiat Fastback',
                valorCompra: 119990,
                valorAssinatura: 2550,
                tempoMeses: 18,
                estado: 'CE',
                entrada: 119990,
                
                kmMensal: 1000,
                taxaFinanciamentoMensal: 1.49,
                rendimentoMensal: 0.85,
                
                seguroAnualReais: 0,     
                manutencaoAnualReais: 0, 
                ipvaAnualReais: 0,       
                valorRevendaReais: 0,    
                
                depreciacaoAnualPercent: 12, 
                emplacamento: 800, 
                licenciamentoAnual: 180, 
            });

            const [resultados, setResultados] = useState(null);

            // --- AUTO-C√ÅLCULO DOS CAMPOS EDIT√ÅVEIS ---
            useEffect(() => {
                const valor = Number(inputs.valorCompra) || 0;
                const estadoInfo = ESTADOS_IPVA.find(e => e.sigla === inputs.estado) || { taxa: 3.0 };
                const novoSeguro = valor * 0.02;
                const novoIpva = valor * (estadoInfo.taxa / 100);

                setInputs(prev => ({ ...prev, seguroAnualReais: novoSeguro, ipvaAnualReais: novoIpva }));
            }, [inputs.valorCompra, inputs.estado]);

            useEffect(() => {
                const kmAnual = (Number(inputs.kmMensal) || 0) * 12;
                const custoManutencao = (kmAnual / 10000) * 950;
                setInputs(prev => ({ ...prev, manutencaoAnualReais: Math.round(custoManutencao) }));
            }, [inputs.kmMensal]);

            useEffect(() => {
                const valor = Number(inputs.valorCompra) || 0;
                const anos = (Number(inputs.tempoMeses) || 0) / 12;
                const taxaDep = (Number(inputs.depreciacaoAnualPercent) || 0) / 100;
                const revendaEstimada = valor * Math.pow((1 - taxaDep), anos);
                
                setInputs(prev => ({ ...prev, valorRevendaReais: Math.round(revendaEstimada) }));
            }, [inputs.valorCompra, inputs.tempoMeses, inputs.depreciacaoAnualPercent]);

            // --- HANDLERS ---
            const handleBasicChange = (e) => {
                const { name, value } = e.target;
                setInputs(prev => ({ ...prev, [name]: value === '' ? '' : value }));
            };

            const handleMoneyChange = (e) => {
                const { name, value } = e.target;
                const onlyDigits = value.replace(/\D/g, '');
                const numericValue = Number(onlyDigits) / 100;
                setInputs(prev => ({ ...prev, [name]: numericValue }));
            };

            const getDisplayValue = (key) => {
                const val = inputs[key];
                if (val === '' || val === undefined) return '';
                return formatCurrency(val).replace('R$', '').trim();
            };

            // --- C√ÅLCULO FINAL ---
            const calcular = () => {
                const safeInputs = { ...inputs };
                Object.keys(safeInputs).forEach(key => {
                    if (safeInputs[key] === '') safeInputs[key] = 0;
                });

                const {
                    valorCompra, valorAssinatura, tempoMeses,
                    entrada, taxaFinanciamentoMensal,
                    seguroAnualReais, manutencaoAnualReais, ipvaAnualReais, valorRevendaReais,
                    emplacamento, licenciamentoAnual,
                    rendimentoMensal
                } = safeInputs;

                const tempoAnos = Number(tempoMeses) / 12;

                // CEN√ÅRIO A: COMPRAR
                const valorFinanciado = valorCompra - entrada;
                let totalPagoCarro = Number(entrada);
                
                if (valorFinanciado > 0) {
                    const taxa = Number(taxaFinanciamentoMensal) / 100;
                    const parcela = valorFinanciado * (taxa * Math.pow(1 + taxa, tempoMeses)) / (Math.pow(1 + taxa, tempoMeses) - 1);
                    totalPagoCarro += (parcela * tempoMeses);
                }

                let somaIPVA = 0, somaSeguro = 0, somaManutencao = 0, somaLicenciamento = 0;
                let valorBaseCalculo = Number(valorCompra); 
                
                const taxaIpvaImplicita = valorCompra > 0 ? Number(ipvaAnualReais) / valorCompra : 0;
                const taxaSeguroImplicita = valorCompra > 0 ? Number(seguroAnualReais) / valorCompra : 0;
                const depRate = inputs.depreciacaoAnualPercent / 100;

                for (let ano = 1; ano <= Math.ceil(tempoAnos); ano++) {
                    const mesesNoAno = (ano * 12 > tempoMeses) ? (tempoMeses % 12 || 12) : 12;
                    const fatorAno = mesesNoAno / 12;

                    somaIPVA += (valorBaseCalculo * taxaIpvaImplicita) * fatorAno;
                    somaSeguro += (valorBaseCalculo * taxaSeguroImplicita) * fatorAno;
                    somaManutencao += Number(manutencaoAnualReais) * fatorAno;
                    somaLicenciamento += Number(licenciamentoAnual) * fatorAno;

                    valorBaseCalculo = valorBaseCalculo * (1 - depRate);
                }

                const valorFinalRevenda = Number(valorRevendaReais);
                const montanteEntradaInvestida = Number(entrada) * Math.pow((1 + rendimentoMensal/100), tempoMeses);
                const custoOportunidadeEntrada = montanteEntradaInvestida - Number(entrada);

                const custosTotais = totalPagoCarro + somaIPVA + somaSeguro + somaManutencao + Number(emplacamento) + somaLicenciamento + custoOportunidadeEntrada;
                const custoTotalCompra = custosTotais - valorFinalRevenda;

                // CEN√ÅRIO B: ASSINAR
                const totalAssinatura = Number(valorAssinatura) * Number(tempoMeses);
                const montanteCapitalPreservado = Number(entrada) * Math.pow((1 + rendimentoMensal/100), tempoMeses);
                const rendimentoCapital = montanteCapitalPreservado - Number(entrada);
                const custoTotalAssinatura = totalAssinatura - rendimentoCapital;

                setResultados({
                    compra: {
                        custoFinal: custoTotalCompra,
                        revenda: valorFinalRevenda,
                        oportunidade: custoOportunidadeEntrada,
                        ipva: somaIPVA,
                        seguro: somaSeguro,
                        manutencao: somaManutencao,
                        emplacamento: Number(emplacamento),
                        licenciamento: somaLicenciamento
                    },
                    assinatura: {
                        custoFinal: custoTotalAssinatura,
                        totalPago: totalAssinatura,
                        rendimento: rendimentoCapital
                    },
                    melhorOpcao: custoTotalCompra < custoTotalAssinatura ? 'COMPRA' : 'ASSINATURA',
                    diferenca: Math.abs(custoTotalCompra - custoTotalAssinatura)
                });
            };

            const getBarWidth = (val1, val2) => {
                const max = Math.max(val1, val2);
                if (max === 0) return { w1: 0, w2: 0 };
                return { w1: (val1 / max) * 100, w2: (val2 / max) * 100 };
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 pb-12">
                    <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white py-8 px-4 shadow-lg sticky top-0 z-10">
                        <div className="max-w-5xl mx-auto">
                            <div className="flex items-center gap-3 mb-1">
                                <Car className="w-8 h-8" />
                                <h1 className="text-2xl md:text-3xl font-bold">Comprar ou Assinar?</h1>
                            </div>
                            <p className="text-blue-100 opacity-90 text-sm md:text-base">Simulador Financeiro de Ve√≠culos</p>
                        </div>
                    </div>

                    <main className="max-w-5xl mx-auto px-4 mt-6 grid grid-cols-1 md:grid-cols-12 gap-6">
                        
                        {/* --- PAINEL DE DADOS --- */}
                        <div className="md:col-span-5 space-y-4">
                            <Card className="p-5">
                                <h2 className="text-lg font-bold text-slate-700 mb-4 flex items-center gap-2">
                                    <Calculator className="w-5 h-5 text-blue-600" />
                                    Par√¢metros
                                </h2>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">Modelo</label>
                                        <input type="text" name="modelo" value={inputs.modelo} onChange={handleBasicChange} className="w-full p-3 md:p-2 border border-gray-300 rounded-lg focus:border-blue-500 outline-none" />
                                    </div>

                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="block text-[10px] font-bold text-slate-500 uppercase mb-1">Valor Compra</label>
                                            <div className="relative">
                                                <span className="absolute left-2 top-3 md:top-2 text-gray-500 text-sm">R$</span>
                                                <input type="text" inputMode="numeric" name="valorCompra" value={getDisplayValue('valorCompra')} onChange={handleMoneyChange} className="w-full pl-7 p-3 md:p-2 border border-gray-300 rounded-lg focus:border-blue-500 outline-none font-medium text-sm" />
                                            </div>
                                        </div>
                                        <div>
                                            <label className="block text-[10px] font-bold text-slate-500 uppercase mb-1">Valor Assinatura</label>
                                            <div className="relative">
                                                <span className="absolute left-2 top-3 md:top-2 text-gray-500 text-sm">R$</span>
                                                <input type="text" inputMode="numeric" name="valorAssinatura" value={getDisplayValue('valorAssinatura')} onChange={handleMoneyChange} className="w-full pl-7 p-3 md:p-2 border border-gray-300 rounded-lg focus:border-blue-500 outline-none font-medium text-sm" />
                                            </div>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-3 gap-2">
                                        <div>
                                            <label className="block text-[10px] font-bold text-slate-500 uppercase mb-1">Meses</label>
                                            <input type="number" name="tempoMeses" value={inputs.tempoMeses} onChange={handleBasicChange} className="w-full p-3 md:p-2 border border-gray-300 rounded-lg focus:border-blue-500 outline-none text-sm" />
                                        </div>
                                        <div>
                                            <label className="block text-[10px] font-bold text-slate-500 uppercase mb-1">Estado</label>
                                            <select name="estado" value={inputs.estado} onChange={handleBasicChange} className="w-full p-3 md:p-2 border border-gray-300 rounded-lg focus:border-blue-500 outline-none bg-white text-sm" >
                                                {ESTADOS_IPVA.map(e => (<option key={e.sigla} value={e.sigla}>{e.sigla}</option>))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-[10px] font-bold text-slate-500 uppercase mb-1">Km/M√™s</label>
                                            <input type="number" name="kmMensal" value={inputs.kmMensal} onChange={handleBasicChange} className="w-full p-3 md:p-2 border border-gray-300 rounded-lg focus:border-blue-500 outline-none text-sm" />
                                        </div>
                                    </div>

                                    <div className="border-t border-gray-100 my-2 pt-2">
                                        <label className="block text-xs font-bold text-slate-500 uppercase mb-1">A Sua Entrada (Capital dispon√≠vel)</label>
                                        <div className="relative">
                                            <span className="absolute left-3 top-3 md:top-2 text-gray-500">R$</span>
                                            <input type="text" inputMode="numeric" name="entrada" value={getDisplayValue('entrada')} onChange={handleMoneyChange} className="w-full pl-9 p-3 md:p-2 border border-gray-300 rounded-lg focus:border-blue-500 outline-none font-medium" />
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-3 bg-gray-50 p-2 rounded border border-gray-100">
                                        {inputs.entrada < inputs.valorCompra && (
                                            <div>
                                                <label className="block text-[10px] font-bold text-slate-500 uppercase mb-1">Juros Financ. (% a.m)</label>
                                                <input type="number" step="0.01" name="taxaFinanciamentoMensal" value={inputs.taxaFinanciamentoMensal} onChange={handleBasicChange} className="w-full p-2 md:p-1 border border-gray-300 rounded focus:border-blue-500 outline-none text-sm" />
                                            </div>
                                        )}
                                        <div>
                                            <label className="block text-[10px] font-bold text-slate-500 uppercase mb-1">Rend. Invest. (% a.m)</label>
                                            <input type="number" step="0.01" name="rendimentoMensal" value={inputs.rendimentoMensal} onChange={handleBasicChange} className="w-full p-2 md:p-1 border border-gray-300 rounded focus:border-blue-500 outline-none text-sm" />
                                        </div>
                                    </div>

                                    {/* Custos Edit√°veis */}
                                    <div className="space-y-3 pt-2">
                                        <h3 className="text-xs font-bold text-slate-700 uppercase border-b pb-1">Estimativas (Valores Anuais/Totais)</h3>
                                        
                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="block text-[10px] font-bold mb-1 text-gray-600">Seguro Anual (R$)</label>
                                                <div className="relative">
                                                    <span className="absolute left-2 top-2 md:top-1.5 text-gray-500 text-xs">R$</span>
                                                    <input type="text" inputMode="numeric" name="seguroAnualReais" value={getDisplayValue('seguroAnualReais')} onChange={handleMoneyChange} className="w-full pl-6 p-2 md:p-1.5 border rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none bg-blue-50/50" />
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-[10px] font-bold mb-1 text-gray-600">IPVA Anual (R$)</label>
                                                <div className="relative">
                                                    <span className="absolute left-2 top-2 md:top-1.5 text-gray-500 text-xs">R$</span>
                                                    <input type="text" inputMode="numeric" name="ipvaAnualReais" value={getDisplayValue('ipvaAnualReais')} onChange={handleMoneyChange} className="w-full pl-6 p-2 md:p-1.5 border rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none bg-blue-50/50" />
                                                </div>
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-3">
                                            <div>
                                                <label className="block text-[10px] font-bold mb-1 text-gray-600">Manuten√ß√£o Anual (R$)</label>
                                                <div className="relative">
                                                    <span className="absolute left-2 top-2 md:top-1.5 text-gray-500 text-xs">R$</span>
                                                    <input type="text" inputMode="numeric" name="manutencaoAnualReais" value={getDisplayValue('manutencaoAnualReais')} onChange={handleMoneyChange} className="w-full pl-6 p-2 md:p-1.5 border rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none bg-blue-50/50" />
                                                </div>
                                            </div>
                                            <div>
                                                <label className="block text-[10px] font-bold mb-1 text-gray-600">Valor Revenda Final (R$)</label>
                                                <div className="relative">
                                                    <span className="absolute left-2 top-2 md:top-1.5 text-gray-500 text-xs">R$</span>
                                                    <input type="text" inputMode="numeric" name="valorRevendaReais" value={getDisplayValue('valorRevendaReais')} onChange={handleMoneyChange} className="w-full pl-6 p-2 md:p-1.5 border rounded text-sm focus:ring-1 focus:ring-blue-500 outline-none bg-blue-50/50" />
                                                </div>
                                            </div>
                                        </div>

                                        <details className="text-xs text-gray-500 pt-2">
                                            <summary className="cursor-pointer hover:text-blue-600 py-2">Editar Despesas de Registo</summary>
                                            <div className="grid grid-cols-2 gap-2 mt-2">
                                                <div>
                                                    <label className="block text-[9px] font-bold mb-1">Emplacamento (√önico)</label>
                                                    <input type="text" inputMode="numeric" name="emplacamento" value={getDisplayValue('emplacamento')} onChange={handleMoneyChange} className="w-full p-2 md:p-1 border rounded text-xs focus:ring-1 focus:ring-blue-500" />
                                                </div>
                                                <div>
                                                    <label className="block text-[9px] font-bold mb-1">Licenciamento (Anual)</label>
                                                    <input type="text" inputMode="numeric" name="licenciamentoAnual" value={getDisplayValue('licenciamentoAnual')} onChange={handleMoneyChange} className="w-full p-2 md:p-1 border rounded text-xs focus:ring-1 focus:ring-blue-500" />
                                                </div>
                                                <div>
                                                    <label className="block text-[9px] font-bold mb-1">Taxa Deprecia√ß√£o (%)</label>
                                                    <input type="number" name="depreciacaoAnualPercent" value={inputs.depreciacaoAnualPercent} onChange={handleBasicChange} className="w-full p-2 md:p-1 border rounded text-xs focus:ring-1 focus:ring-blue-500" />
                                                </div>
                                            </div>
                                        </details>
                                    </div>

                                    <button 
                                        onClick={calcular}
                                        className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 md:py-3 px-4 rounded-lg shadow-md transition-transform transform active:scale-95 flex justify-center items-center gap-2 mt-4"
                                    >
                                        <Calculator className="w-5 h-5" />
                                        CALCULAR RESULTADOS
                                    </button>

                                </div>
                            </Card>
                        </div>

                        {/* --- PAINEL DE RESULTADOS --- */}
                        <div className="md:col-span-7 space-y-6">
                            {!resultados ? (
                                <div className="h-full flex flex-col items-center justify-center text-gray-400 border-2 border-dashed border-gray-200 rounded-xl p-10 min-h-[400px]">
                                    <Car className="w-16 h-16 mb-4 opacity-20" />
                                    <p className="text-lg font-medium text-center">
                                        Simule os seus gastos.<br/>Preencha e clique em Calcular.
                                    </p>
                                </div>
                            ) : (
                                <>
                                    <div className={`rounded-xl p-6 text-white shadow-lg transition-all ${resultados.melhorOpcao === 'ASSINATURA' ? 'bg-indigo-600' : 'bg-emerald-600'}`}>
                                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                            <div>
                                                <h3 className="text-sm font-medium opacity-90 uppercase tracking-wider">Veredicto</h3>
                                                <div className="text-2xl md:text-3xl font-bold mt-1 flex items-center gap-3">
                                                    {resultados.melhorOpcao === 'ASSINATURA' ? 'Assinatura vence' : 'Compra vence'}
                                                    <CheckCircle2 className="w-8 h-8" />
                                                </div>
                                                <p className="mt-1 opacity-90 text-sm md:text-base">
                                                    Poupan√ßa estimada de <span className="font-bold bg-white/20 px-1.5 rounded">{formatCurrency(resultados.diferenca)}</span>
                                                </p>
                                            </div>
                                            <div className="bg-white/10 rounded-lg p-3 text-center w-full md:w-auto min-w-[120px]">
                                                <div className="text-xs uppercase opacity-75">Custo Mensal</div>
                                                <div className="text-xl font-bold">
                                                    {formatCurrency(
                                                        resultados.melhorOpcao === 'ASSINATURA' 
                                                        ? resultados.assinatura.custoFinal / inputs.tempoMeses 
                                                        : resultados.compra.custoFinal / inputs.tempoMeses
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <Card className="p-6">
                                        <h3 className="text-gray-700 font-bold mb-6 flex items-center gap-2">
                                            <Banknote className="w-5 h-5" />
                                            Custo L√≠quido Total ({inputs.tempoMeses} meses)
                                        </h3>
                                        <div className="space-y-6">
                                            <div>
                                                <div className="flex justify-between text-sm mb-1">
                                                    <span className="font-bold text-emerald-900">Comprar</span>
                                                    <span className="font-bold text-emerald-900">{formatCurrency(resultados.compra.custoFinal)}</span>
                                                </div>
                                                <div className="h-6 bg-gray-100 rounded-full overflow-hidden relative">
                                                    <div className="h-full bg-emerald-500 absolute top-0 left-0 rounded-full transition-all duration-1000 ease-out" style={{ width: `${getBarWidth(resultados.compra.custoFinal, resultados.assinatura.custoFinal).w1}%` }}></div>
                                                </div>
                                            </div>
                                            <div>
                                                <div className="flex justify-between text-sm mb-1">
                                                    <span className="font-bold text-indigo-900">Assinar</span>
                                                    <span className="font-bold text-indigo-900">{formatCurrency(resultados.assinatura.custoFinal)}</span>
                                                </div>
                                                <div className="h-6 bg-gray-100 rounded-full overflow-hidden relative">
                                                    <div className="h-full bg-indigo-500 absolute top-0 left-0 rounded-full transition-all duration-1000 ease-out" style={{ width: `${getBarWidth(resultados.compra.custoFinal, resultados.assinatura.custoFinal).w2}%` }}></div>
                                                </div>
                                            </div>
                                        </div>
                                    </Card>

                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <Card className="p-5 border-t-4 border-t-emerald-500 bg-gray-50">
                                            <h4 className="font-bold text-gray-700 mb-3 border-b pb-2 flex items-center gap-2">
                                                <Car className="w-4 h-4" />
                                                Detalhes da Compra
                                            </h4>
                                            <ul className="space-y-2 text-sm text-gray-600">
                                                <li className="flex justify-between">
                                                    <span>Deprecia√ß√£o Real</span>
                                                    <span className="text-red-600 font-medium">- {formatCurrency(inputs.valorCompra - resultados.compra.revenda)}</span>
                                                </li>
                                                <li className="flex justify-between">
                                                    <span>IPVA</span>
                                                    <span className="text-red-600 font-medium">- {formatCurrency(resultados.compra.ipva)}</span>
                                                </li>
                                                <li className="flex justify-between">
                                                    <span className="flex items-center gap-1"><Shield className="w-3 h-3"/> Seguro</span>
                                                    <span className="text-red-600 font-medium">- {formatCurrency(resultados.compra.seguro)}</span>
                                                </li>
                                                <li className="flex justify-between">
                                                    <span className="flex items-center gap-1"><Wrench className="w-3 h-3"/> Manuten√ß√£o</span>
                                                    <span className="text-red-600 font-medium">- {formatCurrency(resultados.compra.manutencao)}</span>
                                                </li>
                                                
                                                <li className="flex justify-between bg-gray-100/50 p-1 rounded-sm">
                                                    <span className="flex items-center gap-1 text-xs"><FileText className="w-3 h-3"/> Emplacamento</span>
                                                    <span className="text-red-600 font-medium text-xs">- {formatCurrency(resultados.compra.emplacamento)}</span>
                                                </li>
                                                <li className="flex justify-between bg-gray-100/50 p-1 rounded-sm">
                                                    <span className="flex items-center gap-1 text-xs"><FileText className="w-3 h-3"/> Licenciamento</span>
                                                    <span className="text-red-600 font-medium text-xs">- {formatCurrency(resultados.compra.licenciamento)}</span>
                                                </li>

                                                <li className="flex justify-between mt-2">
                                                    <span className="flex items-center gap-1">Custo Oportunidade <Info className="w-3 h-3"/></span>
                                                    <span className="text-orange-600 font-medium">- {formatCurrency(resultados.compra.oportunidade)}</span>
                                                </li>
                                                <li className="pt-2 border-t flex justify-between text-gray-700 text-xs font-bold mt-1">
                                                    <span>Valor Recuperado (Revenda)</span>
                                                    <span className="text-emerald-600">+ {formatCurrency(resultados.compra.revenda)}</span>
                                                </li>
                                            </ul>
                                        </Card>

                                        <Card className="p-5 border-t-4 border-t-indigo-500 bg-gray-50 flex flex-col justify-between">
                                            <div>
                                                <h4 className="font-bold text-gray-700 mb-3 border-b pb-2 flex items-center gap-2">
                                                    <FileText className="w-4 h-4" />
                                                    Detalhes da Assinatura
                                                </h4>
                                                <ul className="space-y-2 text-sm text-gray-600">
                                                    <li className="flex justify-between">
                                                        <span>Total Mensalidades</span>
                                                        <span className="text-red-600 font-medium">- {formatCurrency(resultados.assinatura.totalPago)}</span>
                                                    </li>
                                                    <li className="flex justify-between opacity-50">
                                                        <span>Custos Operacionais</span>
                                                        <span className="font-medium">R$ 0,00</span>
                                                    </li>
                                                    <li className="flex justify-between opacity-50">
                                                        <span>Registo / Docs</span>
                                                        <span className="font-medium">R$ 0,00</span>
                                                    </li>
                                                    <li className="flex justify-between pt-4 border-t border-dashed mt-2">
                                                        <span className="font-bold flex items-center gap-1 text-slate-700">Rend. Invest. <TrendingDown className="w-3 h-3 rotate-180"/></span>
                                                        <span className="text-emerald-600 font-bold">+ {formatCurrency(resultados.assinatura.rendimento)}</span>
                                                    </li>
                                                </ul>
                                            </div>
                                            <div className="mt-4 bg-indigo-50 p-3 rounded text-xs text-indigo-800 leading-snug">
                                                Ao assinar, mant√©m <strong>{formatCurrency(inputs.entrada)}</strong> investidos. O rendimento deste dinheiro ajuda a pagar a conta final.
                                            </div>
                                        </Card>
                                    </div>
                                </>
                            )}
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
